<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
    <title>PLIM</title>
    <%include layout/head/default.html%>
    <script type="text/javascript" src="https://api.map.baidu.com/api?v=2.0&ak=hDMeBeFR3ccORh6CsKzOGIsc&s=1"></script>
    <script>
        //2011-7-25
        (function(){        //闭包
        function load_script(xyUrl, callback){
            var head = document.getElementsByTagName('head')[0];
            var script = document.createElement('script');
            script.type = 'text/javascript';
            script.src = xyUrl;
            //借鉴了jQuery的script跨域方法
            script.onload = script.onreadystatechange = function(){
                if((!this.readyState || this.readyState === "loaded" || this.readyState === "complete")){
                    callback && callback();
                    // Handle memory leak in IE
                    script.onload = script.onreadystatechange = null;
                    if ( head && script.parentNode ) {
                        head.removeChild( script );
                    }
                }
            };
            // Use insertBefore instead of appendChild  to circumvent an IE6 bug.
            head.insertBefore( script, head.firstChild );
        }
        function translate(point,type,callback){
            var callbackName = 'cbk_' + Math.round(Math.random() * 10000);    //随机函数名
            var xyUrl = "http://api.map.baidu.com/ag/coord/convert?from="+ type + "&to=4&x=" + point.lng + "&y=" + point.lat + "&callback=BMap.Convertor." + callbackName;
            //动态创建script标签
            load_script(xyUrl);
            BMap.Convertor[callbackName] = function(xyResult){
                delete BMap.Convertor[callbackName];    //调用完需要删除改函数
                var point = new BMap.Point(xyResult.x, xyResult.y);
                callback && callback(point);
            }
        }

        window.BMap = window.BMap || {};
        BMap.Convertor = {};
        BMap.Convertor.translate = translate;
        })();
    </script>
</head>

<body ng-app="plim" ng-controller="PLIMController">
    <ion-side-menus>

        <!-- 中心内容 -->
        <ion-side-menu-content>
            <ion-header-bar class="bar-royal">
                <button class="button button-icon" ng-click="toggleLeftMenu()">
                    <i class="icon ion-navicon"></i>
                </button>
                <h1 class="title">PLIM</h1>
                <button class="button button-icon" ng-click="refresh()">
                    <i class="icon ion-loop"></i>
                </button>
            </ion-header-bar>
            <ion-content>
                <div ng-view></div>
            </ion-content>
        </ion-side-menu-content>

        <!-- 左侧菜单 -->
        <ion-side-menu side="left">
            <ion-header-bar class="bar-royal">
                <h1 class="title">菜单</h1>
            </ion-header-bar>
            <ion-content scroll="false">
                <ion-list>
                    <ion-item ng-repeat="leftMenu in leftMenus" ng-click="selectleftMenu(leftMenu, $index)" ng-class="{active: activeLeftMenu == leftMenu}"
                    ng-href="{{leftMenu.href}}">
                        {{leftMenu.title}}
                    </ion-item>
                </ion-list>
            </ion-content>
        </ion-side-menu>

    </ion-side-menus>

    <script id="location.html" type="text/ng-template">
        <button class="button button-balanced" onclick="start()">
            start
        </button>
        <button class="button button-balanced" onclick="stop()">
            stop
        </button>
        <div id="location"></div>
        <div id="head"></div>
    </script>

    <script src="/js/app.js"></script>
</body>

</html>